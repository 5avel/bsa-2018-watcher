<div class="chat-list-panel">
  <p-accordion>
    <p-accordionTab>
      <p-header>
        Chats
        <i class="panel-icon fa fa-plus" (click)="displayCreateChat=true"></i>
      </p-header>
      <p-listbox [options]="chatList" [(ngModel)]="selectedChat" (onChange)="openChat()">
        <ng-template let-chat pTemplate="item">
          <div class="ui-helper-clearfix">
            <i class="pi pi-fw pi-users"></i>
            <span> {{chat.value.name}}</span>
          </div>
        </ng-template>
      </p-listbox>
    </p-accordionTab>
  </p-accordion>
</div>

<div class="conversation-panel" [hidden]="!displayConversation">
  <p-accordion [activeIndex]="0">
    <p-accordionTab>
      <p-header>
        {{selectedChat?.name}}
        <i class="panel-icon fa fa-close" (click)="displayConversation=false"></i>
        <i class="panel-icon fa fa-cog"></i>
      </p-header>
      <div class="conversation-panel-content ui-fluid">
        <div class="conversation-message-list">
          <p-card *ngFor="let message of selectedChat?.messages">
            <div class="ui-g">
              <div class="ui-g-2 ui-g-nopad">
                <i class="fa fa-2x fa-user"></i>
              </div>
              <div class="ui-g-10 ui-g-nopad">
                <strong>{{message.user.displayName}}</strong>
                <div class="">{{message.text}}</div>
              </div>
            </div>
          </p-card>
        </div>
        <div class="ui-inputgroup">
          <input type="text" pInputText [(ngModel)]="textMessage" placeholder="Write message">
          <button pButton icon="fa fa-send" (click)="sendMessage()"></button>
        </div>
      </div>
    </p-accordionTab>
  </p-accordion>
</div>

<p-dialog [(visible)]="displayCreateChat" [modal]="true" [responsive]="true" [width]="350" [baseZIndex]="10000">
  <p-header>
    New chat
  </p-header>
  <form [formGroup]="newChatForm">
    <div class="ui-fluid">
      <p class="field">Name*:</p>
      <input type="text" pInputText formControlName="name" placeholder="Enter chat name" ng-required="true">

      <p class="field">Add users:</p>
      <div class="ui-inputgroup">
        <input type="email" pInputText formControlName="email" placeholder="Enter email">
        <button pButton icon="fa fa-plus" (click)="addUser()"></button>
      </div>

      <div *ngFor="let user of addedUsers">
        <p class="field">{{user.displayName}} ({{user.email}})</p>
      </div>
    </div>
  </form>

  <p-footer>
    <button type="button" pButton (click)="createNewChat()" label="Create" [disabled]="!newChatForm.valid"></button>
  </p-footer>
</p-dialog>